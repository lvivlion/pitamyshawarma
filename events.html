<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Events - Pita My Shawarma | Upcoming Events</title>
    <meta name="description"
        content="Check out the Pita My Shawarma event calendar! See our upcoming events, festivals, and pop-ups around Pittsburgh.">
    <meta name="keywords" content="events, calendar, pittsburgh, festivals, street food, shawarma, food events">

    <link rel="stylesheet" href="css/output.css">
    <link rel="stylesheet" href="css/styles.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700;800&family=Inter:wght@400;500;600;700&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">

    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #F9FAFB;
        }

        h1,
        h2,
        h3,
        .font-display {
            font-family: 'Playfair Display', serif;
        }

        .brand-teal {
            color: #02a69b;
        }

        .bg-brand-teal {
            background-color: #02a69b;
        }

        /* Event List Styles */
        .event-item {
            background: white;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            padding: 1.5rem;
            transition: all 0.3s ease;
            border-left: 4px solid #02a69b;
        }

        .event-item:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(2, 166, 155, 0.15);
        }

        .event-date-badge {
            background: linear-gradient(135deg, #02a69b 0%, #01867d 100%);
            color: white;
            border-radius: 10px;
            padding: 0.75rem 1rem;
            text-align: center;
            min-width: 80px;
        }

        .event-date-badge .day {
            font-size: 1.75rem;
            font-weight: 700;
            line-height: 1;
        }

        .event-date-badge .month {
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .event-action-btn {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            border-radius: 8px;
            font-size: 0.875rem;
            font-weight: 500;
            transition: all 0.2s ease;
        }

        .event-action-btn.primary {
            background-color: #02a69b;
            color: white;
        }

        .event-action-btn.primary:hover {
            background-color: #01867d;
        }

        .event-action-btn.secondary {
            background-color: #f0fdf9;
            color: #02a69b;
            border: 1px solid #02a69b;
        }

        .event-action-btn.secondary:hover {
            background-color: #02a69b;
            color: white;
        }

        /* Loader */
        .loader {
            border: 5px solid #e2e8f0;
            border-top: 5px solid #02a69b;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1.2s linear infinite;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        /* Status Badge */
        .status-badge {
            display: inline-flex;
            align-items: center;
            gap: 0.25rem;
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 600;
        }

        .status-badge.upcoming {
            background-color: #f0fdf9;
            color: #02a69b;
        }

        .status-badge.live {
            background-color: #dcfce7;
            color: #16a34a;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {

            0%,
            100% {
                opacity: 1;
            }

            50% {
                opacity: 0.7;
            }
        }
    </style>
</head>

<body class="text-gray-800">

    <!-- Global Header -->
    <div id="global-header"></div>

    <!-- Hero Section -->
    <div class="relative h-[40vh] flex items-center justify-center text-white text-center">
        <div class="absolute inset-0 bg-black">
            <img src="img/shawarma-pittsburgh-food.webp" class="w-full h-full object-cover opacity-60"
                alt="Pita My Shawarma Events">
        </div>
        <div class="relative z-10 px-4">
            <h1 class="text-5xl md:text-6xl font-display font-bold mb-4">Upcoming Events</h1>
            <p class="text-xl max-w-2xl mx-auto">Find us at festivals, markets, and special events around Pittsburgh!
            </p>
        </div>
    </div>

    <!-- Events List Section -->
    <main class="container mx-auto px-4 py-12 max-w-4xl">
        <div class="text-center mb-10">
            <h2 class="text-3xl font-display font-bold text-gray-800 mb-4">Where to Find Us</h2>
            <p class="text-gray-600 max-w-2xl mx-auto">Check out our upcoming appearances below. Click on any event to
                get directions or add it to your calendar!</p>
        </div>

        <!-- Loading State -->
        <div id="loader" class="text-center py-16">
            <div class="loader inline-block"></div>
            <p class="mt-4 text-gray-600">Loading upcoming events...</p>
        </div>

        <!-- Events List -->
        <div id="events-list" class="space-y-4"></div>

        <!-- No Events State -->
        <div id="no-events" class="hidden text-center py-16">
            <div class="w-20 h-20 bg-teal-100 rounded-full flex items-center justify-center mx-auto mb-6">
                <i class="fas fa-calendar-times fa-2x text-teal-600"></i>
            </div>
            <h3 class="font-bold font-display text-2xl text-gray-800 mb-2">No Upcoming Events</h3>
            <p class="text-gray-500">We're planning our next appearances. Check back soon!</p>
        </div>

        <!-- Error State -->
        <div id="error-state" class="hidden text-center py-16">
            <div class="w-20 h-20 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-6">
                <i class="fas fa-exclamation-triangle fa-2x text-red-500"></i>
            </div>
            <h3 class="font-bold font-display text-2xl text-gray-800 mb-2">Unable to Load Events</h3>
            <p class="text-gray-500">Please try again later or contact us for event information.</p>
        </div>

        <!-- CTA Section -->
        <div class="text-center mt-16 p-8 bg-gradient-to-r from-teal-50 to-cyan-50 rounded-xl border border-teal-100">
            <h3 class="text-2xl font-display font-bold text-teal-700 mb-4">Want the Food Truck at Your Event?</h3>
            <p class="text-gray-600 mb-6">Book our food truck for your next private event, corporate gathering, or
                festival!</p>
            <a href="food-truck.html"
                class="inline-block bg-brand-teal text-white font-semibold px-8 py-3 rounded-full hover:bg-teal-700 transition-colors">
                <i class="fas fa-truck mr-2"></i>Book the Food Truck
            </a>
        </div>
    </main>

    <!-- Footer -->
    <div id="global-footer"></div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/ical.js@1.5.0/build/ical.min.js"></script>
    <script src="js/components.js"></script>
    <script>
        loadHeader('events.html', 'standard');
    </script>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const eventsListEl = document.getElementById('events-list');
            const loaderEl = document.getElementById('loader');
            const noEventsEl = document.getElementById('no-events');
            const errorStateEl = document.getElementById('error-state');

            async function fetchAndDisplayEvents() {
                const calendarId = 'c_3c3c220520ded7c9cab52a3da9958575fbd81a0af1c7c97ffda827916104b133@group.calendar.google.com';
                const icalUrl = `https://calendar.google.com/calendar/ical/${encodeURIComponent(calendarId)}/public/basic.ics`;
                const proxyUrl = `https://cors.eu.org/${icalUrl}`;

                try {
                    const response = await fetch(proxyUrl);
                    if (!response.ok) throw new Error('Network response failed.');
                    const icalData = await response.text();
                    const events = parseICal(icalData);

                    loaderEl.style.display = 'none';

                    if (events.length > 0) {
                        renderEvents(events);
                    } else {
                        noEventsEl.classList.remove('hidden');
                    }
                } catch (error) {
                    console.error('Error fetching events:', error);
                    loaderEl.style.display = 'none';
                    errorStateEl.classList.remove('hidden');
                }
            }

            function parseICal(icalData) {
                const jcalData = ICAL.parse(icalData);
                const vcalendar = new ICAL.Component(jcalData);
                return vcalendar.getAllSubcomponents('vevent').map(vevent => {
                    const event = new ICAL.Event(vevent);
                    if (event.endDate.toJSDate() >= new Date()) {
                        return {
                            uid: event.uid,
                            summary: event.summary,
                            location: event.location,
                            description: event.description,
                            startDate: event.startDate.toJSDate(),
                            endDate: event.endDate.toJSDate()
                        };
                    }
                    return null;
                }).filter(Boolean).sort((a, b) => a.startDate - b.startDate);
            }

            function renderEvents(events) {
                eventsListEl.innerHTML = '';
                const now = new Date();

                events.forEach(event => {
                    const isLive = now >= event.startDate && now <= event.endDate;
                    const directionsUrl = event.location
                        ? `https://www.google.com/maps/dir/?api=1&destination=${encodeURIComponent(event.location)}`
                        : null;

                    const eventEl = document.createElement('div');
                    eventEl.className = 'event-item';
                    eventEl.innerHTML = `
                        <div class="flex flex-col md:flex-row gap-4">
                            <div class="event-date-badge flex-shrink-0">
                                <div class="day">${event.startDate.getDate()}</div>
                                <div class="month">${event.startDate.toLocaleDateString('en-US', { month: 'short' })}</div>
                            </div>
                            <div class="flex-grow">
                                <div class="flex flex-wrap items-center gap-2 mb-2">
                                    <h3 class="font-bold text-xl text-gray-800">${event.summary}</h3>
                                    ${isLive
                            ? '<span class="status-badge live"><i class="fas fa-circle text-xs"></i> Happening Now</span>'
                            : '<span class="status-badge upcoming"><i class="fas fa-clock"></i> Upcoming</span>'}
                                </div>
                                <div class="space-y-1 text-gray-600 mb-4">
                                    <p class="flex items-center gap-2">
                                        <i class="far fa-clock fa-fw text-teal-600"></i>
                                        ${formatEventTime(event.startDate, event.endDate)}
                                    </p>
                                    ${event.location ? `
                                    <p class="flex items-center gap-2">
                                        <i class="fas fa-map-marker-alt fa-fw text-teal-600"></i>
                                        ${event.location}
                                    </p>` : ''}
                                </div>
                                <div class="flex flex-wrap gap-2">
                                    ${directionsUrl ? `
                                    <a href="${directionsUrl}" target="_blank" class="event-action-btn primary">
                                        <i class="fas fa-diamond-turn-right"></i> Get Directions
                                    </a>` : ''}
                                    <a href="${generateGoogleCalendarLink(event)}" target="_blank" class="event-action-btn secondary">
                                        <i class="fab fa-google"></i> Add to Calendar
                                    </a>
                                </div>
                            </div>
                        </div>
                    `;
                    eventsListEl.appendChild(eventEl);
                });
            }

            function formatEventTime(start, end) {
                const dateOpts = { weekday: 'long', month: 'long', day: 'numeric' };
                const timeOpts = { hour: 'numeric', minute: '2-digit', hour12: true };
                const dateStr = start.toLocaleDateString('en-US', dateOpts);
                const startTime = start.toLocaleTimeString('en-US', timeOpts);
                const endTime = end.toLocaleTimeString('en-US', timeOpts);
                return `${dateStr} â€¢ ${startTime} - ${endTime}`;
            }

            function generateGoogleCalendarLink(event) {
                const formatTime = (date) => date.toISOString().replace(/-|:|\.\d{3}/g, '');
                const url = new URL('https://calendar.google.com/calendar/render');
                url.searchParams.set('action', 'TEMPLATE');
                url.searchParams.set('text', event.summary);
                url.searchParams.set('dates', `${formatTime(event.startDate)}/${formatTime(event.endDate)}`);
                url.searchParams.set('location', event.location || '');
                return url.toString();
            }

            // Start fetching events
            fetchAndDisplayEvents();
        });
    </script>
</body>

</html>