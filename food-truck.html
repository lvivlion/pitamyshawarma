<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Food Truck - Pita My Shawarma | Authentic Lebanese Food</title>
    <meta name="description"
        content="Book the Pita My Shawarma food truck for your next event in Pittsburgh. Authentic Lebanese shawarma, falafel, and more on wheels.">
    <meta name="keywords"
        content="food truck, pittsburgh, lebanese food, events, party food, shawarma, falafel, catering truck">

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto+Condensed:wght@300;400;700&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="css/output.css">
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
</head>

<body>

    <!-- Header -->
    <div id="global-header"></div>

    <!-- Hero -->
    <div class="relative h-[50vh] flex items-center justify-center text-white text-center">
        <div class="absolute inset-0 bg-black">
            <img src="img/shawarma-pittsburgh-food.webp" class="w-full h-full object-cover opacity-60"
                alt="Pita My Shawarma Food">
        </div>
        <div class="relative z-10 px-4 reveal-on-scroll">
            <h1 class="text-5xl md:text-6xl font-display font-bold mb-4">Pita My Shawarma Food Truck</h1>
            <p class="text-xl max-w-2xl mx-auto">Bringing the authentic flavors of Lebanon to your favorite Pittsburgh
                spots and events.</p>
        </div>
    </div>

    <!-- Content -->
    <div class="container mx-auto px-4 py-16 max-w-5xl">
        <div class="grid md:grid-cols-2 gap-12 items-center mb-16">
            <div class="reveal-on-scroll">
                <h2 class="text-3xl font-display font-bold text-teal-700 mb-4">Book Our Food Truck</h2>
                <p class="text-gray-600 mb-6 leading-relaxed">
                    Want to have the best shawarma in Pittsburgh at your next event? Our food truck is available for
                    weddings, corporate events, festivals, and private parties. Please fill out the form below to
                    request a booking.
                </p>
                <ul class="space-y-3 text-gray-700 mb-8">
                    <li><i class="fas fa-check text-teal-500 mr-2"></i> Festivals & Public Events</li>
                    <li><i class="fas fa-check text-teal-500 mr-2"></i> Corporate Gatherings</li>
                    <li><i class="fas fa-check text-teal-500 mr-2"></i> Weddings & Late Night Snacks</li>
                    <li><i class="fas fa-check text-teal-500 mr-2"></i> Private Neighborhood Block Parties</li>
                </ul>
                <p class="text-gray-600 mb-4 font-semibold italic">Interested in catering instead? <a
                        href="catering.html" class="text-brand-teal hover:underline text-lg">Check out our Catering
                        page.</a></p>
            </div>
            <div
                class="glass-panel p-4 bg-white -rotate-2 hover:rotate-0 transition-transform duration-500 reveal-on-scroll">
                <img src="img/freshfood.webp" alt="Fresh Shawarma" loading="lazy"
                    class="rounded-lg w-full h-full object-cover">
            </div>
        </div>

        <!-- Google Form -->
        <div class="w-full max-w-4xl mx-auto mb-16 reveal-on-scroll">
            <div class="bg-white rounded-xl shadow-lg p-2 md:p-6">
                <h3 class="text-2xl font-display font-bold text-teal-700 mb-6 text-center">Food Truck Inquiry Form</h3>
                <div class="flex justify-center">
                    <iframe
                        src="https://docs.google.com/forms/d/e/1FAIpQLSfCQAzrzl4ZAiE_9_bXHeOr3EEbT50Lscdb6pBX1YfJCNLghA/viewform?embedded=true"
                        width="640" height="1550" frameborder="0" marginheight="0" marginwidth="0"
                        class="w-full max-w-[640px]" loading="lazy">Loadingâ€¦</iframe>
                </div>
            </div>
        </div>

        <!-- FAQ or Info -->
        <div class="bg-white rounded-xl shadow-lg p-8 md:p-12 reveal-on-scroll">
            <h3 class="text-2xl font-display font-bold text-gray-800 mb-6 text-center">Food Truck Information</h3>
            <div class="grid md:grid-cols-3 gap-8 text-center">
                <div>
                    <div
                        class="w-12 h-12 bg-teal-100 text-teal-600 rounded-full flex items-center justify-center mx-auto mb-4 text-xl">
                        <i class="fas fa-calendar-alt"></i>
                    </div>
                    <h4 class="font-bold mb-2">Booking Lead Time</h4>
                    <p class="text-gray-600 text-sm">We recommend booking at least 2-4 weeks in advance, especially for
                        weekend events during the summer.</p>
                </div>
                <div>
                    <div
                        class="w-12 h-12 bg-teal-100 text-teal-600 rounded-full flex items-center justify-center mx-auto mb-4 text-xl">
                        <i class="fas fa-map-marker-alt"></i>
                    </div>
                    <h4 class="font-bold mb-2">Service Area</h4>
                    <p class="text-gray-600 text-sm">Our food truck serves the greater Pittsburgh area and surrounding
                        suburbs.</p>
                </div>
                <div>
                    <div
                        class="w-12 h-12 bg-teal-100 text-teal-600 rounded-full flex items-center justify-center mx-auto mb-4 text-xl">
                        <i class="fas fa-utensils"></i>
                    </div>
                    <h4 class="font-bold mb-2">Menu Options</h4>
                    <p class="text-gray-600 text-sm">We offer a customizable menu for the food truck to fit your event's
                        needs.</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Upcoming Stops Section (Interactive Map) -->
    <div class="bg-gray-100 py-16">
        <div class="container mx-auto px-4">
            <div class="text-center mb-8">
                <h2 class="text-3xl font-display font-bold text-gray-800 mb-4">Find Our Food Truck</h2>
                <p class="text-gray-600 max-w-2xl mx-auto">Check out our upcoming stops on the map below. Click on an
                    event to see details and get directions!</p>
            </div>

            <div class="bg-white rounded-xl shadow-lg overflow-hidden" style="height: 600px;">
                <div class="flex flex-col md:flex-row h-full">
                    <div class="w-full md:w-1/3 h-1/2 md:h-full flex flex-col bg-gray-50 border-r">
                        <div class="p-4 border-b">
                            <h3 class="text-xl font-display font-bold">Upcoming Stops</h3>
                        </div>
                        <div id="event-list-container" class="flex-grow overflow-y-auto p-4">
                            <div id="loader" class="text-center py-10">
                                <div class="loader inline-block"></div>
                                <p class="mt-4 text-gray-600">Finding our food truck...</p>
                            </div>
                            <div id="event-list" class="space-y-3"></div>
                            <div id="no-events" class="hidden text-center p-6"><i
                                    class="fas fa-calendar-times fa-2x text-yellow-500 mb-4"></i>
                                <h3 class="font-bold font-display text-xl">No Upcoming Events</h3>
                                <p class="text-gray-500 mt-1 text-sm">Please check back soon!</p>
                            </div>
                        </div>
                    </div>

                    <div class="w-full md:w-2/3 h-1/2 md:h-full">
                        <div id="map" style="height: 100%; width: 100%;"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <div id="global-footer"></div>

    <!-- Leaflet CSS and JS for Map -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
        integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
        integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
    <script src="https://cdn.jsdelivr.net/npm/ical.js@1.5.0/build/ical.min.js"></script>

    <script src="js/components.js"></script>
    <script>
        loadHeader('food-truck.html', 'standard');
    </script>

    <style>
        /* Event Card Styles */
        .event-card {
            transition: all 0.3s ease;
            border-left: 4px solid transparent;
        }

        .event-card.active,
        .event-card:hover {
            background-color: white;
            transform: translateX(5px);
            box-shadow: 0 10px 20px -5px rgba(0, 0, 0, 0.1);
            border-left-color: #02a69b;
        }

        /* Leaflet Popups */
        .leaflet-popup-content p {
            margin: 5px 0 !important;
        }

        .leaflet-popup-content-wrapper {
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        /* Loader */
        .loader {
            border: 5px solid #e2e8f0;
            border-top: 5px solid #02a69b;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1.2s linear infinite;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        /* Custom Marker Icon */
        .map-marker-icon {
            background-color: white;
            border-radius: 50%;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
            display: flex;
            justify-content: center;
            align-items: center;
            font-weight: bold;
            font-family: 'Inter', sans-serif;
            color: #02a69b;
        }

        .brand-teal-text {
            color: #02a69b;
        }
    </style>

    <!-- Food Truck Map Logic -->
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const eventListEl = document.getElementById('event-list');
            const loaderEl = document.getElementById('loader');
            const noEventsEl = document.getElementById('no-events');

            let map;
            let markers = {};
            let allEvents = [];
            let countdownInterval;

            // 1. INITIALIZE
            function initializeApp() {
                initializeMap();
                fetchAndProcessEvents();
            }

            function initializeMap() {
                map = L.map('map', { zoomControl: false }).setView([40.4406, -79.9959], 10);
                L.control.zoom({ position: 'bottomright' }).addTo(map);
                L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png', {
                    attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors &copy; <a href="https://carto.com/attributions">CARTO</a>',
                    subdomains: 'abcd',
                    maxZoom: 20
                }).addTo(map);
            }

            // 2. DATA FETCHING & PROCESSING
            async function fetchAndProcessEvents() {
                const calendarId = atob('cGl0YW15c2hhd2FybWEuY29tX3JlNGo4cWJkdW9ldnZlY2Z2MGZpNDI2djRnQGdyb3VwLmNhbGVuZGFyLmdvb2dsZS5jb20');
                const icalUrl = `https://calendar.google.com/calendar/ical/${encodeURIComponent(calendarId)}/public/basic.ics`;
                const proxyUrl = `https://cors.eu.org/${icalUrl}`;

                try {
                    const response = await fetch(proxyUrl);
                    if (!response.ok) throw new Error('Network response failed.');
                    const icalData = await response.text();
                    const parsedEvents = parseICal(icalData);
                    if (parsedEvents.length > 0) {
                        allEvents = await geocodeEvents(parsedEvents);
                        renderEventList(allEvents);
                        renderMapMarkers(allEvents);

                        // Start the countdown timer
                        updateCountdowns();
                        if (countdownInterval) clearInterval(countdownInterval);
                        countdownInterval = setInterval(updateCountdowns, 10000);
                    } else {
                        displayNoEvents();
                    }
                } catch (error) {
                    console.error('Error fetching data:', error);
                    loaderEl.innerHTML = `<p class="text-red-500 p-4">Could not load events. Please try again later.</p>`;
                }
            }

            function parseICal(icalData) {
                const jcalData = ICAL.parse(icalData);
                const vcalendar = new ICAL.Component(jcalData);
                return vcalendar.getAllSubcomponents('vevent').map(vevent => {
                    const event = new ICAL.Event(vevent);
                    if (event.endDate.toJSDate() >= new Date()) {
                        return {
                            uid: event.uid,
                            summary: event.summary,
                            location: event.location,
                            startDate: event.startDate.toJSDate(),
                            endDate: event.endDate.toJSDate()
                        };
                    }
                    return null;
                }).filter(Boolean).sort((a, b) => a.startDate - b.startDate);
            }

            async function geocodeEvents(events) {
                const promises = events.map(async (event) => {
                    if (!event.location) return event;
                    try {
                        const nominatimUrl = `https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(event.location)}&limit=1`;
                        const proxyUrl = `https://cors.eu.org/${nominatimUrl}`;
                        const response = await fetch(proxyUrl);
                        if (!response.ok) {
                            console.error(`Geocoding fetch failed for "${event.location}" with status: ${response.status}`);
                            return event;
                        }
                        const data = await response.json();
                        if (data && data.length > 0) {
                            event.lat = parseFloat(data[0].lat);
                            event.lon = parseFloat(data[0].lon);
                        }
                    } catch (e) { console.error("Geocoding error:", e); }
                    return event;
                });
                return Promise.all(promises);
            }

            // 3. UI RENDERING
            function renderEventList(events) {
                loaderEl.style.display = 'none';
                eventListEl.innerHTML = '';
                if (events.length === 0) {
                    displayNoEvents();
                    return;
                }
                noEventsEl.classList.add('hidden');
                events.forEach((event, index) => {
                    const card = document.createElement('div');
                    card.id = `event-${event.uid}`;
                    card.className = 'event-card bg-gray-100 p-3 rounded-lg cursor-pointer';
                    const directionsUrl = event.location ? `https://www.google.com/maps/dir/?api=1&destination=${encodeURIComponent(event.location)}` : '#';

                    card.innerHTML = `
                    <div class="flex justify-between items-start">
                        <p class="font-semibold brand-teal-text text-sm">${formatEventDate(event.startDate)}</p>
                        <div class="flex space-x-3 text-gray-500 text-base">
                            <a href="${directionsUrl}" target="_blank" class="hover:text-teal-600" title="Get Directions"><i class="fas fa-diamond-turn-right"></i></a>
                            <a href="${generateCalendarLink('google', event)}" target="_blank" class="hover:text-teal-600" title="Add to Google Calendar"><i class="fab fa-google"></i></a>
                            <a href="${generateCalendarLink('ics', event)}" class="hover:text-teal-600" title="Add to Apple/Outlook Calendar"><i class="fab fa-apple"></i></a>
                        </div>
                    </div>
                    <h3 class="font-bold text-lg mt-1"><span class="brand-teal-text mr-2">${index + 1}.</span>${event.summary}</h3>
                    <p class="text-gray-600 text-sm mt-1"><i class="far fa-clock fa-fw mr-1"></i>${formatEventTime(event.startDate, event.endDate)}</p>
                    ${event.location ? `<p class="text-gray-600 text-sm mt-1"><i class="fas fa-map-marker-alt fa-fw mr-1"></i>${event.location}</p>` : ''}
                    <p class="text-sm font-medium text-gray-500 mt-2" id="countdown-${event.uid}"></p>
                `;
                    eventListEl.appendChild(card);

                    card.addEventListener('click', () => {
                        if (event.lat && event.lon) {
                            map.flyTo([event.lat, event.lon], 15);
                            markers[event.uid]?.openPopup();
                        }
                        document.querySelectorAll('.event-card').forEach(c => c.classList.remove('active'));
                        card.classList.add('active');
                    });

                    const marker = markers[event.uid];
                    if (marker) {
                        card.addEventListener('mouseenter', () => marker.setZIndexOffset(1000));
                        card.addEventListener('mouseleave', () => marker.setZIndexOffset(0));
                    }
                });
            }

            function renderMapMarkers(events) {
                Object.values(markers).forEach(marker => map.removeLayer(marker));
                markers = {};
                const bounds = [];

                events.forEach((event, index) => {
                    if (event.lat && event.lon) {
                        const foodTruckIcon = L.divIcon({
                            html: `<span class="text-lg">${index + 1}</span>`,
                            className: 'map-marker-icon',
                            iconSize: [32, 32],
                            iconAnchor: [16, 16]
                        });

                        const marker = L.marker([event.lat, event.lon], { icon: foodTruckIcon }).addTo(map);
                        marker.bindPopup(`<h3 class="font-bold font-display text-lg">${event.summary}</h3><p>${event.location}</p><a href="https://www.google.com/maps/dir/?api=1&destination=${encodeURIComponent(event.location)}" target="_blank" class="font-semibold text-teal-600 hover:underline">Get Directions</a>`);
                        marker.on('click', () => {
                            const card = document.getElementById(`event-${event.uid}`);
                            document.querySelectorAll('.event-card').forEach(c => c.classList.remove('active'));
                            card?.classList.add('active');
                            card?.scrollIntoView({ behavior: 'smooth', block: 'center' });
                        });
                        markers[event.uid] = marker;
                        bounds.push([event.lat, event.lon]);
                    }
                });

                if (bounds.length > 0) {
                    map.fitBounds(bounds, { padding: [50, 50], maxZoom: 12 });
                }
            }

            function displayNoEvents() {
                loaderEl.style.display = 'none';
                noEventsEl.classList.remove('hidden');
            }

            // 4. COUNTDOWN
            function updateCountdowns() {
                const now = new Date();
                allEvents.forEach(event => {
                    const countdownEl = document.getElementById(`countdown-${event.uid}`);
                    if (!countdownEl) return;

                    const timeRemaining = event.startDate - now;

                    if (timeRemaining > 0) {
                        const { days, hours, minutes } = formatTimeRemaining(timeRemaining);
                        countdownEl.innerHTML = `(Starts in ${days}d ${hours}h ${minutes}m)`;
                        countdownEl.className = 'text-sm font-medium text-gray-500 mt-2';
                    } else if (now < event.endDate) {
                        countdownEl.innerHTML = `(Event is happening now!)`;
                        countdownEl.className = 'text-sm font-bold text-green-600 mt-2';
                    } else {
                        countdownEl.innerHTML = `(Event has ended)`;
                        countdownEl.className = 'text-sm font-medium text-red-500 mt-2';
                    }
                });
            }

            function formatTimeRemaining(milliseconds) {
                const totalSeconds = Math.floor(milliseconds / 1000);
                const totalMinutes = Math.floor(totalSeconds / 60);
                const totalHours = Math.floor(totalMinutes / 60);

                const days = Math.floor(totalHours / 24);
                const hours = totalHours % 24;
                const minutes = totalMinutes % 60;

                return { days, hours, minutes };
            }

            // 5. UTILITIES
            function formatEventDate(date) { return date.toLocaleDateString('en-US', { weekday: 'long', month: 'long', day: 'numeric' }); }
            function formatEventTime(start, end) { const opt = { hour: 'numeric', minute: '2-digit', hour12: true }; return `${start.toLocaleTimeString('en-US', opt).replace(' ', '')} - ${end.toLocaleTimeString('en-US', opt).replace(' ', '')}`; }

            function generateCalendarLink(type, event) {
                const formatTime = (date) => date.toISOString().replace(/-|:|\.\\d{3}/g, '');
                const startTime = formatTime(event.startDate);
                const endTime = formatTime(event.endDate);

                if (type === 'google') {
                    const url = new URL('https://calendar.google.com/calendar/render');
                    url.searchParams.set('action', 'TEMPLATE');
                    url.searchParams.set('text', event.summary);
                    url.searchParams.set('dates', `${startTime}/${endTime}`);
                    url.searchParams.set('location', event.location || '');
                    return url.toString();
                }
                if (type === 'ics') {
                    const icsData = ['BEGIN:VCALENDAR', 'VERSION:2.0', 'BEGIN:VEVENT', `UID:${event.uid}`, `DTSTAMP:${formatTime(new Date())}`, `DTSTART:${startTime}`, `DTEND:${endTime}`, `SUMMARY:${event.summary}`, `LOCATION:${event.location || ''}`, 'END:VEVENT', 'END:VCALENDAR'].join('\\n');
                    return `data:text/calendar;charset=utf8,${encodeURIComponent(icsData)}`;
                }
            }

            // START THE APP
            initializeApp();
        });
    </script>


    <script>
        const scrollElements = document.querySelectorAll('.reveal-on-scroll');
        const elementInView = (el, dividend = 1) => {
            const elementTop = el.getBoundingClientRect().top;
            return (elementTop <= (window.innerHeight || document.documentElement.clientHeight) / dividend);
        };
        const handleScrollAnimation = () => {
            scrollElements.forEach((el) => {
                if (elementInView(el, 1.25)) el.classList.add('is-visible');
            });
        };
        window.addEventListener('scroll', handleScrollAnimation);
        handleScrollAnimation();
    </script>
</body>

</html>